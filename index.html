<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartHub AI v1.0.3</title>

<style>
    /* ---------- –û–ë–©–ò–ï –°–¢–ò–õ–ò ---------- */
    :root {
        --bg: #0b0f19;
        --panel: #141a2c;
        --text: #ffffff;
        --bubble-user: #00c3ff;
        --bubble-ai: rgba(100,255,150,0.4);
    }

    [data-theme="light"] {
        --bg: #f6f7fb;
        --panel: #ffffff;
        --text: #111;
        --bubble-user: #00aaff;
        --bubble-ai: #d7ffe0;
    }

    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: Arial, sans-serif;
        height: 100vh;
        display: flex;
    }

    /* ---------- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ß–ê–¢) ---------- */
    .left-panel {
        flex: 2;
        display: flex;
        flex-direction: column;
        border-right: 2px solid rgba(255,255,255,0.1);
    }

    .header {
        padding: 15px;
        text-align: center;
        font-size: 22px;
        background: var(--panel);
        border-bottom: 2px solid rgba(255,255,255,0.1);
    }

    #chat {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .msg {
        display: flex;
        gap: 10px;
        max-width: 80%;
        animation: fadeIn .3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .msg.user { align-self: flex-end; flex-direction: row-reverse; }

    .bubble {
        padding: 12px 14px;
        border-radius: 16px;
        background: var(--bubble-ai);
    }

    .msg.user .bubble {
        background: var(--bubble-user);
        color: #001;
    }

    .avatar {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        overflow: hidden;
    }

    .avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* ---------- –í–í–û–î –¢–ï–ö–°–¢–ê ---------- */
    .input-bar {
        padding: 12px;
        background: var(--panel);
        display: flex;
        gap: 10px;
    }

    #userInput {
        flex: 1;
        padding: 10px;
        border-radius: 10px;
        border: none;
    }

    button {
        padding: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    #sendBtn { background: #00c3ff; }
    #micBtn { background: #ff3b3b; }
    #speakBtn { background: #00ff99; }

    /* ---------- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ù–ê–°–¢–†–û–ô–ö–ò) ---------- */
    .right-panel {
        width: 280px;
        background: var(--panel);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .settings-title {
        font-size: 20px;
        margin-bottom: 10px;
        text-align: center;
    }

    .toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255,255,255,0.05);
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
    }

    #versionTag {
        opacity: .4;
        font-size: 14px;
        text-align: center;
        margin-top: auto;
    }
</style>
</head>

<body data-theme="dark">

<!-- ------------- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ß–ê–¢) ------------- -->
<div class="left-panel">

    <div class="header">SmartHub AI</div>

    <div id="chat"></div>

    <div class="input-bar">
        <input id="userInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button id="sendBtn" onclick="sendMessage()">‚û§</button>
        <button id="micBtn" onclick="voiceInput()">üé§</button>
        <button id="speakBtn" onclick="speakLast()">üîä</button>
    </div>

</div>

<!-- ------------- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ù–ê–°–¢–†–û–ô–ö–ò) ------------- -->
<div class="right-panel">

    <div class="settings-title">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>

    <div class="toggle" onclick="toggleTheme()">
        <span>–¢–µ–º–∞</span>
        <span id="themeLabel">–¢—ë–º–Ω–∞—è</span>
    </div>

    <div class="toggle" onclick="toggleVoice()">
        <span>–û–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–∞</span>
        <span id="voiceLabel">–í—ã–∫–ª</span>
    </div>

    <div id="versionTag">SmartHub AI v1.0.3</div>
</div>

<script>
/* ---------------- API ---------------- */
const API_URL = "https://openai-proxy-ucgy.onrender.com/v1/chat/completions";

let lastAIMessage = "";
let autoVoice = false;

/* ---------------- –ß–ê–¢ ---------------- */
function addMessage(text, sender) {
    const chat = document.getElementById("chat");

    const wrap = document.createElement("div");
    wrap.className = "msg " + sender;

    const avatar = document.createElement("div");
    avatar.className = "avatar";

    const img = document.createElement("img");
    img.src = sender === "user" ? "avatar-user.png" : "avatar-ai.png";
    avatar.appendChild(img);

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    wrap.appendChild(avatar);
    wrap.appendChild(bubble);
    chat.appendChild(wrap);

    chat.scrollTop = chat.scrollHeight;
}

/* ---------------- –û–¢–ü–†–ê–í–ö–ê ---------------- */
async function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";

    const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: text }]
        })
    });

    const data = await res.json();
    const ai = data.choices?.[0]?.message?.content || "–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞";

    lastAIMessage = ai;
    addMessage(ai, "ai");

    if (autoVoice) speak(ai);
}

/* ---------------- –û–ó–í–£–ß–ö–ê ---------------- */
function speak(text){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ru-RU";
    u.rate = 1;
    speechSynthesis.speak(u);
}

function speakLast(){
    if (!lastAIMessage) return alert("–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞");
    speak(lastAIMessage);
}

/* ---------------- –ì–û–õ–û–°–û–í–û–ô –í–í–û–î ---------------- */
function voiceInput() {
    const R = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!R) return alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω");

    const rec = new R();
    rec.lang = "ru-RU";
    rec.start();

    document.getElementById("micBtn").style.background = "#ffa200";

    rec.onresult = e => {
        document.getElementById("userInput").value = e.results[0][0].transcript;
        document.getElementById("micBtn").style.background = "#ff3b3b";
    };

    rec.onend = () => {
        document.getElementById("micBtn").style.background = "#ff3b3b";
    };
}

/* ---------------- –¢–ï–ú–ê ---------------- */
function toggleTheme(){
    const body = document.body;
    const label = document.getElementById("themeLabel");

    if (body.dataset.theme === "dark") {
        body.dataset.theme = "light";
        label.textContent = "–°–≤–µ—Ç–ª–∞—è";
    } else {
        body.dataset.theme = "dark";
        label.textContent = "–¢—ë–º–Ω–∞—è";
    }
}

/* ---------------- –û–ó–í–£–ß–ö–ê –í–ö–õ/–í–´–ö–õ ---------------- */
function toggleVoice(){
    autoVoice = !autoVoice;
    document.getElementById("voiceLabel").textContent = autoVoice ? "–í–∫–ª" : "–í—ã–∫–ª";
}
</script>

</body>
</html>
